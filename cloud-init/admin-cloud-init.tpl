#cloud-config

# set locale
locale: en_US.UTF-8

# set timezone
timezone: Etc/UTC

# set root password
chpasswd:
  list: |
    root:linux
    ${username}:${password}
  expire: False

ssh_authorized_keys:
${authorized_keys}

ntp:
  enabled: true
  ntp_client: chrony
  config:
    confpath: /etc/chrony.conf
  servers:
${ntp_servers}

# need to disable gpg checks because the cloud image has an untrusted repo
zypper:
  repos:
${repositories}
  config:
    gpgcheck: "off"
    solver.onlyRequires: "true"
    download.use_deltarpm: "true"

# need to remove the standard docker packages that are pre-installed on the
# cloud image because they conflict with the kubic- ones that are pulled by
# the kubernetes packages
# WARNING!!! Do not use cloud-init packages module when SUSE CaaSP Registraion
# Code is provided. In this case repositories will be added in runcmd module 
# with SUSEConnect command after packages module is ran
#packages:

bootcmd:
  - ip link set dev eth0 mtu 1400
  # Hostnames from DHCP - otherwise localhost will be used
  - /usr/bin/sed -ie "s#DHCLIENT_SET_HOSTNAME=\"no\"#DHCLIENT_SET_HOSTNAME=\"yes\"#" /etc/sysconfig/network/dhcp
  - netconfig update -f

runcmd:
${register_scc}
${register_rmt}
${commands}



final_message: "The system is finally up, after $UPTIME seconds"

write_files:
#  - path: /home/sles/.all_nodes
#    permissions: "0644"
#    content: |
#      caasp-terraformmaster-0.caasp.local
#      caasp-terraformworker-0.caasp.local
#      caasp-terraformworker-1.caasp.local
#  - path: /home/sles/.ssh/config
#    encoding: b64
#    permissions: "0644"
#    content: SE9TVCBjYWFzcC10ZXJyYWZvcm1sYi0wLmNhYXNwLmxvY2FsIGNhYXNwLWxiIGxiCiAgSE9TVE5BTUUgY2Fhc3AtdGVycmFmb3JtbGItMC5jYWFzcC5sb2NhbApIT1NUIGNhYXNwLXRlcnJhZm9ybW1hc3Rlci0wLmNhYXNwLmxvY2FsIGNhYXNwLXRlcnJhZm9ybW1hc3Rlci0wIG1hc3Rlci0wCiAgSE9TVE5BTUUgY2Fhc3AtdGVycmFmb3JtbWFzdGVyLTAuY2Fhc3AubG9jYWwKSE9TVCBjYWFzcC10ZXJyYWZvcm13b3JrZXItMC5jYWFzcC5sb2NhbCBjYWFzcC10ZXJyYWZvcm13b3JrZXItMCB3b3JrZXItMAogIEhPU1ROQU1FIGNhYXNwLXRlcnJhZm9ybXdvcmtlci0wLmNhYXNwLmxvY2FsCkhPU1QgY2Fhc3AtdGVycmFmb3Jtd29ya2VyLTEuY2Fhc3AubG9jYWwgY2Fhc3AtdGVycmFmb3Jtd29ya2VyLTEgd29ya2VyLTEKICBIT1NUTkFNRSBjYWFzcC10ZXJyYWZvcm13b3JrZXItMS5jYWFzcC5sb2NhbAo=
  - path: /home/sles/.ssh/id_rsa
    encoding: b64
    permissions: "0600"
    content: LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUJGd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFRRUExSzIwUlBFQVIwaDc3Y3ZHT0lQNGhiM2xKU0IweXVPZmREV0RlTGNRZ2JMcWU4UkhuWjgzCkJpRWduMnlOaTNMOEJrYlpuZzU0U2R3c2dPSTlnUE41M2xqU3FMUSswcUdMV0VNeXovVVpneG4wUzlmcFN4M213RHIwN2UKQ2NSdGNTL0dzdVVIYkYwVEw1cndYQzJiV1ZYeUFrKysra2ZmRjFHemRqbDl5d3dtTHJJTzA4SlhrZFV3UXdBRXM2UktNdApXeGNhenV4THVzZlh3WVJDNDJJb0dRTFB6VEpEYS93VTYyd2NzY3ZDY01jazFxMk9taDI2d0xwVlZsQTV3VUxwdE8wQmQxCkE2bHBZQUgzbEREUTFIK2gzcnhqNWxsZy9nbGJ0RStxTzBGSXovSWZteFppRSswcWFBSHBNNGo3SHpCZHNUNGZ6MUtzMGQKTklQSU9nS0l1d0FBQThpOWpuZjd2WTUzK3dBQUFBZHpjMmd0Y25OaEFBQUJBUURVcmJSRThRQkhTSHZ0eThZNGcvaUZ2ZQpVbElIVEs0NTkwTllONHR4Q0JzdXA3eEVlZG56Y0dJU0NmYkkyTGN2d0dSdG1lRG5oSjNDeUE0ajJBODNuZVdOS290RDdTCm9ZdFlRekxQOVJtREdmUkwxK2xMSGViQU92VHQ0SnhHMXhMOGF5NVFkc1hSTXZtdkJjTFp0WlZmSUNUNzc2Ujk4WFViTjIKT1gzTERDWXVzZzdUd2xlUjFUQkRBQVN6cEVveTFiRnhyTzdFdTZ4OWZCaEVMallpZ1pBcy9OTWtOci9CVHJiQnl4eThKdwp4eVRXclk2YUhickF1bFZXVURuQlF1bTA3UUYzVURxV2xnQWZlVU1ORFVmNkhldkdQbVdXRCtDVnUwVDZvN1FValA4aCtiCkZtSVQ3U3BvQWVremlQc2ZNRjJ4UGgvUFVxelIwMGc4ZzZBb2k3QUFBQUF3RUFBUUFBQVFBdmlkaEdwTHdVTXU2SW04amwKN3hISkMwWkNBenczOGFNOXZZeHltakRWWE9HdTRwUERkc2c4MVlET1FkeHR0RGtEU2lqd2ZIbUV3UE10cCtScGc0TFZJWApPTkJDVWF2Y05BNmx4Y1FZUC9XdmpSVHlTMWhxeUNnV3NvRk5HNXYrOWRmck91aHEzMjhmYi9tVUVSbXRZVm1rREtFNm5vCkFPWFZQSTlGYmE0UTlOVWFJVkJzb3EwTms3aXFlVDY5Wk9LdFM2OHJsK0VBQ2RSTWF4SjU3M0loK2YzL2dBV01LUlltWGQKZ2VJSDQ2NDdlM0FseHhIYmJjNTJnWHltVGlvdjVtTG44dUNscU9CaTdjUUkzUXlKa0RiQlQ4NndHbGtkNG5pQjZWMzV0RgpjVFFNYnpyVmZ6YUFCL1czaHpGR2NjMUpTNGhaOXllQ1gwdkdUYVdVRjErSkFBQUFnUUN2TEU2MkZEODVXemxnQVVZSWttCnAreWw2S3RSNUI0c3pVV1JsNURkSjFCdm5yaVpFSGwxN1NwcVdpcVZRNFVUbFkxRFlSaHQ0NHBoUm1yK1Z2K0lwSHdRa3UKUU0rNXB2THZhTSsxV0lzRGVPNjNpNllBUnBUVkVSZjN4MVVGbWZDN2xKQ09pWVNHT0ViblE2djBDL3dEK0pMQTlXU0V2NQpsQWRCZnZQMUV4TWdBQUFJRUE2OVBrRStxRHpyZVcwU0xyZlNNNGtmeHlpUHh6eXdzMFk0MXo0RjhiME83dklwVVJNaVFzCjhRV2xyN05LOUJ4cjZpS1NNU0RLTlF1SXFCeElyaExFa3ZsTThuSEx0eWlQRkI0RmdVdXdidytzV1JIN1ByTTB6NnVoSkgKQ0JLNEN4ckxDTk1YTXcxNVFSVytHcFM4eFYwMDkxbk5HNUV3V1ZoTmhGNGpFUFBtY0FBQUNCQU9iZTViVDZ5VDB5Y0JNMQpvSlpGWjcxYlIvNUZWa0h6TExFSUZzUG9kclkwN1ZGeVFLNFYrYUtzMG40d3pnSEZYemg5S1l3a2xaa1BXSTlYQjh2RG15CnhEbjBRVjVvR1NIbVRGbThaWWN3LzJyTVh4VGY2UFZMTjNLUWdnVlpQQzF4NkwvOVQwZmx1TWpQZW1NRGNUWVJkMldmanEKZmRkMVpncnY5S1NYNjBhTkFBQUFFSE5zWlhOQVkyRmhjM0F0WVdSdGFXNEJBZz09Ci0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo=
  - path: /home/sles/.ssh/id_rsa.pub
    encoding: b64
    permissions: "0600"
    content: c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFEVXJiUkU4UUJIU0h2dHk4WTRnL2lGdmVVbElIVEs0NTkwTllONHR4Q0JzdXA3eEVlZG56Y0dJU0NmYkkyTGN2d0dSdG1lRG5oSjNDeUE0ajJBODNuZVdOS290RDdTb1l0WVF6TFA5Um1ER2ZSTDErbExIZWJBT3ZUdDRKeEcxeEw4YXk1UWRzWFJNdm12QmNMWnRaVmZJQ1Q3NzZSOThYVWJOMk9YM0xEQ1l1c2c3VHdsZVIxVEJEQUFTenBFb3kxYkZ4ck83RXU2eDlmQmhFTGpZaWdaQXMvTk1rTnIvQlRyYkJ5eHk4Snd4eVRXclk2YUhickF1bFZXVURuQlF1bTA3UUYzVURxV2xnQWZlVU1ORFVmNkhldkdQbVdXRCtDVnUwVDZvN1FValA4aCtiRm1JVDdTcG9BZWt6aVBzZk1GMnhQaC9QVXF6UjAwZzhnNkFvaTcgc2xlc0BjYWFzcC1hZG1pbgo=
  - path: /tmp/deploy_caasp.sh
    content: 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
    encoding: gz+b64
    permissions: "0755"
  - path: /root/recover_deployment.sh
    encoding: b64
    permissions: "0755"
    content: IyEvYmluL2Jhc2gKIyMgUnVuIGFzIHJvb3QgaWYgdGhlIGNsb3VkIGluaXQgc2NyaXB0cyBkb2Vzbid0IGZpbmlzaCBjb3JyZWN0bHkKY2hvd24gLVIgc2xlczp1c2VycyAvaG9tZS9zbGVzCnN1ZG8gLUggLXUgc2xlcyBiYXNoIC90bXAvZGVwbG95X2NhYXNwLnNoCg==
  - path: /home/sles/.bashrc
    encoding: b64
    permissions: "0644"
    content: c2V0IC1vIHZpCmFsaWFzIGtnbj0ia3ViZWN0bCBnZXQgbm9kZXMgLW8gd2lkZSIKYWxpYXMga2dkPSJrdWJlY3RsIGdldCBkZXBsb3ltZW50cyAtbyB3aWRlIgphbGlhcyBrZ3A9Imt1YmVjdGwgZ2V0IHBvZHMgLW8gd2lkZSIKYWxpYXMga2dwYT0ia3ViZWN0bCBnZXQgcG9kcyAtbyB3aWRlIC0tYWxsLW5hbWVzcGFjZXMgfCBsZXNzIiAKYWxpYXMga2c9Imt1YmVjdGwgZ2V0ICIKYWxpYXMga2FmPSJrdWJlY3RsIGFwcGx5IC1mIgphbGlhcyBrZGY9Imt1YmVjdGwgZGVsZXRlIC1mIgphbGlhcyBzY3M9InNrdWJhIGNsdXN0ZXIgc3RhdHVzIgo=
#  - path: /etc/exports
#    encoding: b64
#    permissions: "0644"
#    content: L3B1YmxpYyAxMC4xMTAuMC4wLzIyKHJ3LG5vX3Jvb3Rfc3F1YXNoKQo=
#  - path: /etc/idmapd.conf
#    encoding: b64
#    permissions: "0644"
#    content: W0dlbmVyYWxdCgpWZXJib3NpdHkgPSAwClBpcGVmcy1EaXJlY3RvcnkgPSAvdmFyL2xpYi9uZnMvcnBjX3BpcGVmcwpEb21haW4gPSBjYWFzcC1zdXNlY29uLmxhYgoKW01hcHBpbmddCgpOb2JvZHktVXNlciA9IG5vYm9keQpOb2JvZHktR3JvdXAgPSBub2JvZHkK

